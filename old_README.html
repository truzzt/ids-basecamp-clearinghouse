<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>oldReadme - Documentation</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="ids-clearing-house"><a class="header" href="#ids-clearing-house">IDS Clearing House</a></h1>
<p>The IDS Clearing House Service is a prototype implementation of the <a href="https://github.com/International-Data-Spaces-Association/IDS-RAM_4_0/blob/main/documentation/3_Layers_of_the_Reference_Architecture_Model/3_5_System_Layer/3_5_5_Clearing_House.md">Clearing House</a> component of the <a href="https://internationaldataspaces.org/">Industrial Data Space</a>.</p>
<p>Data in the Clearing House is stored encrypted and practically immutable. There are multiple ways in which the Clearing House enforces Data Immutability:</p>
<ul>
<li>Using the <code>Logging Service</code> there is no way to update an already existing log entry in the database</li>
<li>Log entries in the database include a hash value of the previous log entry, chaining together all log entries. Any change to a previous log entry would require rehashing all following log entries.</li>
<li>The connector logging information in the Clearing House receives a signed receipt from the Clearing House that includes among other things a timestamp and the current chain hash. A single valid receipt in possession of any connector is enough to detect any change to data up to the time indicated in the receipt.</li>
</ul>
<h2 id="architecture"><a class="header" href="#architecture">Architecture</a></h2>
<p>The IDS Clearing House Service currently implements the <a href="https://github.com/International-Data-Spaces-Association/IDS-RAM_4_0/blob/main/documentation/3_Layers_of_the_Reference_Architecture_Model/3_5_System_Layer/3_5_5_Clearing_House.md"><code>Logging Service</code></a>. Other services that comprise the <a href="https://github.com/International-Data-Spaces-Association/IDS-RAM_4_0/blob/main/documentation/3_Layers_of_the_Reference_Architecture_Model/3_5_System_Layer/3_5_5_Clearing_House.md">Clearing House</a> may follow. The Clearing House Service consists of two parts:</p>
<ol>
<li><a href="clearing-house-app"><code>Clearing House App</code></a></li>
<li><a href="clearing-house-processors"><code>Clearing House Processors</code></a></li>
</ol>
<p>The <code>Clearing House App</code> is a REST API written in <a href="https://www.rust-lang.org">Rust</a> that implements the business logic of the Clearing House. The <code>Clearing House Processors</code> is a library written in Java that integrates the <code>Clearing House App</code> into the <a href="https://github.com/industrial-data-space/trusted-connector">Trusted Connector</a>. The <code>Clearing House Processors</code> provide the <code>multipart</code> and <code>idscp2</code> endpoints described in the <a href="https://github.com/International-Data-Spaces-Association/IDS-G/tree/main">IDS-G</a>. These are used by the IDS connectors to interact with the Clearing House. Both <code>Clearing House App</code> and <code>Clearing House Processors</code> are needed to provide the <code>Clearing House Service</code>.</p>
<h2 id="requirements"><a class="header" href="#requirements">Requirements</a></h2>
<ul>
<li><a href="https://www.openssl.org">OpenSSL</a></li>
<li><a href="https://www.mongodb.com">MongoDB</a></li>
<li>(<a href="https://www.docker.com">Docker</a>)</li>
<li><a href="https://github.com/industrial-data-space/trusted-connector">Trusted Connector</a></li>
</ul>
<h2 id="trusted-connector"><a class="header" href="#trusted-connector">Trusted Connector</a></h2>
<p>The Clearing House Service API requires a Trusted Connector <a href="https://github.com/industrial-data-space/trusted-connector">Trusted Connector</a> (Version 7.1.0+) for deployment. The process of setting up a Trusted Connector is described <a href="https://industrial-data-space.github.io/trusted-connector-documentation/docs/getting_started/">here</a>. Using a docker image of the Trusted Connector should be sufficient for most deployments:</p>
<p><code>docker pull fraunhoferaisec/trusted-connector-core:7.2.0</code></p>
<p>The Clearing House Processors are written in Java for use in the Camel Component of the Trusted Connector. To configure the Trusted Connector for the Clearing House Service API, it needs access to the following files inside the docker container (e.g. mounted as a volume):</p>
<ul>
<li><code>clearing-house-processors.jar</code>: The Clearing House Processors need to be placed in the <code>/root/jars</code> folder of the Trusted Connector. The jar file needs to be <a href="clearing-house-processors#building-from-source">build</a> from the Clearing House Processors using <code>gradle</code>.</li>
<li><a href="clearing-house-processors/src/routes/clearing-house-routes.xml"><code>clearing-house-routes.xml</code></a>: The camel routes required by the Clearing House need to be placed in the <code>/root/deploy</code> folder of the Trusted Connector.</li>
<li><a href="docker/application.yml"><code>application.yml</code></a>: This is a new configuration file of Trusted Connector 7.0.0+. The file version in this repository enables the use of some of the environment variables documented in the next section.</li>
</ul>
<p>Besides those files that are specific for the configuration of the Clearing House Service API, the Trusted Connector requires other files for its configuration, e.g. a truststore and a keystore with appropriate key material. Please refer to the <a href="https://industrial-data-space.github.io/trusted-connector-documentation/">Documentation</a> of the Trusted Connector for more information. Also, please check the <a href="https://github.com/industrial-data-space/trusted-connector/tree/master/examples">Examples</a> as they contain up-to-date configurations for the Trusted Connector.</p>
<h4 id="environment-variables"><a class="header" href="#environment-variables">Environment Variables</a></h4>
<p>The Clearing House Processors can override some standard configuration settings of the Trusted Connector using environment variables. If these variables are not set, the Clearing House Processors will use the standard values provided by the Trusted Connector. Some of the variables are mandatory and have to be set:</p>
<ul>
<li><code>TC_DAPS_URL</code>: The url of the DAPS used by the Clearing House. The Trusted Connector uses <code>https://daps.aisec.fraunhofer.de/v3</code> as the default DAPS url.</li>
<li><code>TC_KEYSTORE_PW</code>: The password of the key store mounted in the Trusted Connector. Defaults to <code>password</code>.</li>
<li><code>TC_TRUSTSTORE_PW</code>: The password of the trust store mounted in the Trusted Connector. Defaults to <code>password</code>.</li>
<li><code>TC_CH_ISSUER_CONNECTOR</code>(mandatory): Issuer connector needed for IDS Messages as specified by the <a href="https://github.com/International-Data-Spaces-Association/InformationModel">InfoModel</a></li>
<li><code>TC_CH_AGENT</code>(mandatory): Server agent needed for IDS Messages as specified by the <a href="https://github.com/International-Data-Spaces-Association/InformationModel">InfoModel</a></li>
<li><code>SERVICE_SHARED_SECRET</code>(mandatory): Shared secret, see Configuration section</li>
<li><code>SERVICE_ID_TC</code> (mandatory): Internal ID of the <code>Trusted Connector</code> that is used by the <code>Logging Service</code> to identify the <code>Trusted Connector</code>.</li>
<li><code>SERVICE_ID_LOG</code> (mandatory): Internal ID of the <code>Logging Service</code>.</li>
</ul>
<h4 id="example-configuration-docker-compose"><a class="header" href="#example-configuration-docker-compose">Example Configuration (docker-compose)</a></h4>
<pre><code>tc-core:
    container_name: "tc-core"
    image: fraunhoferaisec/trusted-connector-core:7.1.0
    tty: true
    stdin_open: true
    volumes:
        - /var/run/docker.sock:/var/run/docker.sock
        - ./data/trusted-connector/application.yml:/root/etc/application.yml 
        - ./data/trusted-connector/allow-all-flows.pl:/root/deploy/allow-all-flows.pl
        - ./data/trusted-connector/ch-ids.p12:/root/etc/keystore.p12
        - ./data/trusted-connector/truststore.p12:/root/etc/truststore.p12
        - ./data/trusted-connector/clearing-house-processors-0.10.0.jar:/root/jars/clearing-house-processors.jar
        - ./data/trusted-connector/routes/clearing-house-routes.xml:/root/deploy/clearing-house-routes.xml
    environment:
        TC_DAPS_URL: https://&lt;my-daps-url&gt;
        SERVICE_SHARED_SECRET: &lt;shared-secret&gt;
        SERVICE_ID_TC: &lt;trusted-connector-id&gt;
        SERVICE_ID_LOG: &lt;logging-service-ic&gt;

    ports:
        - "8443:8443"
        - "9999:9999"
        - "29292:29292"
</code></pre>
<h2 id="docker-containers"><a class="header" href="#docker-containers">Docker Containers</a></h2>
<p>The dockerfiles located <a href="docker/">here</a> can be used to create containers for the services of the <a href="clearing-house-app"><code>Clearing House App</code></a>. There are two types of dockerfiles:</p>
<ol>
<li>Simple builds (e.g. <a href="docker/keyring-api.Dockerfile">dockerfile</a>) that require you to build the Service APIs yourself using <a href="https://www.rust-lang.org">Rust</a></li>
<li>Multistage builds (e.g. <a href="docker/keyring-api-multistage.Dockerfile">dockerfile</a>) that have a stage for building the rust code</li>
</ol>
<p>To build the containers check out the repository and in the main directory execute</p>
<p><code>docker build -f docker/&lt;dockerfile&gt; . -t &lt;image-name&gt;</code></p>
<h3 id="container-dependencies"><a class="header" href="#container-dependencies">Container Dependencies</a></h3>
<p><img src="doc/images/ch_container_dependencies.png" alt="Container Dependencies" /></p>
<h3 id="configuration"><a class="header" href="#configuration">Configuration</a></h3>
<p>Please read the configuration section of the service (<a href="https://github.com/Fraunhofer-AISEC/ids-clearing-house-service/tree/architecture-revamp/clearing-house-app#logging-service"><code>Logging Service</code></a>, <a href="https://github.com/Fraunhofer-AISEC/ids-clearing-house-service/tree/architecture-revamp/clearing-house-app#document-api"><code>Document API</code></a>, <a href="https://github.com/Fraunhofer-AISEC/ids-clearing-house-service/tree/architecture-revamp/clearing-house-app#keyring-api"><code>Keyring API</code></a>) you are trying to run, before using <code>docker run</code> oder <code>docker-compose</code>. All Containers build with the provided dockerfiles require at least one volume:</p>
<ol>
<li>The configuration file <code>Rocket.toml</code> is expected at <code>/server/Rocket.toml</code></li>
</ol>
<p>Containers of the Keyring API require an additional volume:</p>
<ol start="2">
<li><code>/server/init_db</code> needs to contain the <code>default_doc_type.json</code></li>
</ol>
<p>Containers of the Logging Service require an additional volume:</p>
<ol start="3">
<li>The folder containing the signing key needs to match the path configured for the signing key in <code>Rocket.toml</code>, e.g. <code>/sever/keys</code></li>
</ol>
<h2 id="shared-secret"><a class="header" href="#shared-secret">Shared Secret</a></h2>
<p>The Clearing House services use signed JWTs with HMAC and a shared secret to ensure a minimal integrity of the requests received. The <code>Trusted Connector</code> as well as the services (<a href="https://github.com/Fraunhofer-AISEC/ids-clearing-house-service/tree/architecture-revamp/clearing-house-app#logging-service"><code>Logging Service</code></a>, <a href="https://github.com/Fraunhofer-AISEC/ids-clearing-house-service/tree/architecture-revamp/clearing-house-app#document-api"><code>Document API</code></a>, <a href="https://github.com/Fraunhofer-AISEC/ids-clearing-house-service/tree/architecture-revamp/clearing-house-app#keyring-api"><code>Keyring API</code></a>) need to have access to the shared secret.</p>
<p>For production use please consider using additional protection measures.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="Proposal.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="Proposal.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
