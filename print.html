<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Documentation</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="quick-start"><a class="header" href="#quick-start">Quick Start</a></h1>
<h2 id="prerequesits"><a class="header" href="#prerequesits">Prerequesits</a></h2>
<p>To run the quick start example please ensure to have a working DAPS.</p>
<h3 id="private-key"><a class="header" href="#private-key">Private Key</a></h3>
<p>You will need the private key in the following formats:</p>
<ul>
<li>.jks</li>
<li>.der</li>
</ul>
<p>The .jks should be generated from the MDS Portal</p>
<p>To generate the .der key run</p>
<pre><code class="language-sh">openssl genpkey -algorithm RSA \
                -pkeyopt rsa_keygen_bits:4096 \
                -outform der \
                -out private_key.der
</code></pre>
<h3 id="environment"><a class="header" href="#environment">Environment</a></h3>
<pre><code class="language-.env">VERSION=1.0.0-beta.3
SERVICE_ID=1
SHARED_SECRET=changethis
KEY_PASSWORD=password
DAPS_URL=
DAPS_JWKS_URL=
API_KEY=changethis
CLIENT_ID=
DATABASE_URL=postgres://
</code></pre>
<h2 id="docker-composeyml"><a class="header" href="#docker-composeyml">docker-compose.yml</a></h2>
<pre><code class="language-sh">docker compose up
</code></pre>
<pre><code class="language-docker-compoye.yml">version: "3.8"

services:
    ch-app:
        image: ghcr.io/ids-basecamp/clearinghouse/ch-app:$VERSION 
        environment:
            CH_APP_DATABASE_URL: $DATABASE_URL
            SERVICE_ID_LOG: $SERVICE_ID
            SHARED_SECRET: $SHARED_SECRET
        volumes:
            - ./YOUR_PRIVATE_KEY.der:/app/keys/private_key.der:ro

    ch-edc:
        image: ghcr.io/ids-basecamp/clearinghouse/ch-edc:$VERSION
        environment:
            WEB_HTTP_PORT: 11001
            WEB_HTTP_PATH: /
            EDC_IDS_ID: urn:connector:example-connector
            EDC_IDS_TITLE: 'truzzt Test EDC Connector'
            EDC_IDS_DESCRIPTION: 'Minimally configured Open Source EDC built by truzzt.'
            EDC_IDS_ENDPOINT: http://ch-edc:11003/api/v1/ids
            IDS_WEBHOOK_ADDRESS: http://ch-edc:11003
            EDC_IDS_CURATOR: https://truzzt.com
            EDC_IDS_MAINTAINER: https://truzzt.com
            EDC_CONNECTOR_NAME: truzzt-example-connector
            EDC_HOSTNAME: ch-edc
            EDC_API_AUTH_KEY: $API_KEY
            EDC_WEB_REST_CORS_ENABLED: 'true'
            EDC_WEB_REST_CORS_HEADERS: 'origin,content-type,accept,authorization,x-api-key'
            EDC_WEB_REST_CORS_ORIGINS: '*'
            EDC_VAULT: /resources/vault/edc/vault.properties
            EDC_OAUTH_TOKEN_URL: $DAPS_URL
            EDC_OAUTH_PROVIDER_JWKS_URL: $DAPS_JWKS_URL
            EDC_OAUTH_ENDPOINT_AUDIENCE: idsc:IDS_CONNECTORS_ALL
            EDC_OAUTH_CLIENT_ID: $CLIENT_ID
            EDC_KEYSTORE: /resources/vault/edc/keystore.jks
            EDC_KEYSTORE_PASSWORD: $KEY_PASSWORD
            EDC_OAUTH_CERTIFICATE_ALIAS: 1
            EDC_OAUTH_PRIVATE_KEY_ALIAS: 1
            TRUZZT_CLEARINGHOUSE_JWT_AUDIENCE: $SERVICE_ID
            TRUZZT_CLEARINGHOUSE_JWT_ISSUER: ch-edc
            TRUZZT_CLEARINGHOUSE_JWT_SIGN_SECRET: $SHARED_SECRET 
            TRUZZT_CLEARINGHOUSE_JWT_EXPIRES_AT: 30
            TRUZZT_CLEARINGHOUSE_APP_BASE_URL: http://ch-app:8000
        volumes:
            - ./YOUR_PRIVATE_KEY.jks:/resources/vault/edc/keystore.jks
            - ./vault.properties:/resources/vault/edc/vault.properties

</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="clearinghouse-app-installation"><a class="header" href="#clearinghouse-app-installation">Clearinghouse App Installation</a></h1>
<p>The Clearinghouse App (<code>ch-app</code>) comes pre-packaged in a docker container.</p>
<h2 id="releases"><a class="header" href="#releases">Releases</a></h2>
<p>For existing releases visit <a href="https://github.com/ids-basecamp/clearinghouse/pkgs/container/clearinghouse%2Fch-app">ids-basecamp-clearinghouse/ch-app Releases</a>.</p>
<h2 id="usage"><a class="header" href="#usage">Usage</a></h2>
<p>Starting the <code>ch-app</code> Docker-only, use the following command and adapt it to your needs.</p>
<pre><code class="language-sh">docker run -d \
    -p 8000:8000 \
    -v ${PRIVATE_KEY_PATH}:/app/keys/private_key.der:ro \
    -e CH_APP_PROCESS_DATABASE_URL='mongodb://mongohost:27017' \
    -e CH_APP_KEYRING_DATABASE_URL='mongodb://mongohost:27017' \
    -e CH_APP_DOCUMENT_DATABASE_URL='mongodb://mongohost:27017' \
    -e CH_APP_CLEAR_DB='false' \
    -e CH_APP_LOG_LEVEL='INFO' \
    -e CH_APP_STATIC_PROCESS_OWNER='MDS_ID' \
    -e SERVICE_ID_LOG='1' \
    -e SHARED_SECRET='123' \
    --name ch-app \
    ghcr.io/truzzt/ids-basecamp-clearing/ch-app:${TAG}
</code></pre>
<p>The following example starts the <code>ch-app</code> together with a <code>mongodb</code> also running on docker (good for local development):</p>
<pre><code class="language-sh"># Create a docker network
docker network create testch
# Start mongodb
docker run -d -p 27017:27017 --net=testch --name mongohost mongo
# Start ch-app
docker run -d \
    -p 8000:8000 --net=testch \
    -v ${PRIVATE_KEY_PATH}:/app/keys/private_key.der:ro \
    -e CH_APP_PROCESS_DATABASE_URL='mongodb://mongohost:27017' \
    -e CH_APP_KEYRING_DATABASE_URL='mongodb://mongohost:27017' \
    -e CH_APP_DOCUMENT_DATABASE_URL='mongodb://mongohost:27017' \
    -e CH_APP_CLEAR_DB='false' \
    -e CH_APP_LOG_LEVEL='INFO' \
    -e CH_APP_STATIC_PROCESS_OWNER='MDS_ID' \
    -e SERVICE_ID_LOG='1' \
    -e SHARED_SECRET='123' \
    --name ch-app \
    ghcr.io/truzzt/ids-basecamp-clearing/ch-app:${TAG}

# ---
# Cleanup
docker rm -f mongohost ch-app
docker network rm testch
</code></pre>
<h2 id="build"><a class="header" href="#build">Build</a></h2>
<p>To build the ch-app yourself change into the <code>/clearing-house-app</code> directory and run <code>docker build -t ch-app:latest .</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="installation"><a class="header" href="#installation">Installation</a></h1>
<h2 id="clearinghouse-edc"><a class="header" href="#clearinghouse-edc">Clearinghouse-edc</a></h2>
<p>This module contains the Clearing House Extension that works with the Eclipse Dataspace Connector
allowing logging operations.</p>
<h3 id="configurations"><a class="header" href="#configurations">Configurations</a></h3>
<p>It is required to configure those parameters:</p>
<div class="table-wrapper"><table><thead><tr><th>Parameter name</th><th>Description</th><th>Default value</th></tr></thead><tbody>
<tr><td><code>truzzt.clearinghouse.jwt.audience</code></td><td>Defines the intended recipients of the token</td><td>1</td></tr>
<tr><td><code>truzzt.clearinghouse.jwt.issuer</code></td><td>Person or entity offering the token</td><td>1</td></tr>
<tr><td><code>truzzt.clearinghouse.jwt.sign.secret</code></td><td>Secret key to encode the token</td><td>123</td></tr>
<tr><td><code>truzzt.clearinghouse.jwt.expires.at</code></td><td>Time to token Expiration (in Seconds)</td><td>30</td></tr>
<tr><td><code>truzzt.clearinghouse.app.base.url</code></td><td>Base URL from the clearing house app</td><td>http://localhost:8000</td></tr>
</tbody></table>
</div>
<h3 id="build-1"><a class="header" href="#build-1">Build</a></h3>
<p>To build the project run the command below:</p>
<pre><code>./gradlew build
</code></pre>
<h3 id="running"><a class="header" href="#running">Running</a></h3>
<p>Local execution:</p>
<pre><code>java -Dedc.fs.config=launchers/connector-local/resources/config.properties -Dedc.keystore=launchers/connector-local/resources/keystore.jks -Dedc.keystore.password=password -Dedc.vault=launchers/connector-local/resources/vault.properties -jar launchers/connector-local/build/libs/clearing-house-edc.jar
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="tests"><a class="header" href="#tests">Tests</a></h1>
<h2 id="clearinghouse-edc-1"><a class="header" href="#clearinghouse-edc-1">Clearinghouse-edc</a></h2>
<p>For the test clearinghouse-edc it uses Junit 5 and Jacoco for the coverage.</p>
<h3 id="running-tests"><a class="header" href="#running-tests">Running Tests</a></h3>
<p>To run the unit-tests execute the following command:</p>
<pre><code>./gradlew test
</code></pre>
<h3 id="test-coverage"><a class="header" href="#test-coverage">Test Coverage</a></h3>
<p>To generate the tests coverage execute the following command:</p>
<pre><code>./gradlew jacocoTestReport
</code></pre>
<p>The coverage reports will be available in the following folders:</p>
<ul>
<li><a href="content/admin-guide/./core/build/reports/jacoco/test/html/index.html">core/build/reports/jacoco/test/html/index.html</a></li>
<li><a href="content/admin-guide/./extensions/multipart/build/reports/jacoco/test/html/index.html">extensions/multipart/build/reports/jacoco/test/html/index.html</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="maintenance"><a class="header" href="#maintenance">Maintenance</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="api-docs"><a class="header" href="#api-docs">API Docs</a></h1>
<p>Swagger and Postman Collection can be found <a href="https://github.com/truzzt/ids-basecamp-clearinghouse-postman">here</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="architecture"><a class="header" href="#architecture">Architecture</a></h1>
<p>The Clearingouse consist of two services: The Clearinghouse-EDC and the Clearinghouse-App. The Clearinghouse-EDC is used to terminate IDS connections and map the requests to the API of the Clearinghouse-App. The Clearinghouse-App is the brain of the the Clearinghouse and uses complex algorithms to encrypt and store log messages in the MongoDB and provide mechanisms to query for log messages.</p>
<pre><?xml version="1.0" encoding="utf-8"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" data-d2-version="v0.6.9" preserveAspectRatio="xMinYMin meet" viewBox="0 0 1392 420"><svg class="d2-1566166734 d2-svg" width="1392" height="420" viewBox="-101 -85 1392 420"><rect x="-101.000000" y="-85.000000" width="1392.000000" height="420.000000" rx="0.000000" fill="#FFFFFF" class=" fill-N7" stroke-width="0" /><style type="text/css"><![CDATA[
.d2-1566166734 .text {
	font-family: "d2-1566166734-font-regular";
}
@font-face {
	font-family: d2-1566166734-font-regular;
	src: url("data:application/font-woff;base64,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");
}
.d2-1566166734 .text-bold {
	font-family: "d2-1566166734-font-bold";
}
@font-face {
	font-family: d2-1566166734-font-bold;
	src: url("data:application/font-woff;base64,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");
}
.d2-1566166734 .text-italic {
	font-family: "d2-1566166734-font-italic";
}
@font-face {
	font-family: d2-1566166734-font-italic;
	src: url("data:application/font-woff;base64,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");
}]]></style><style type="text/css"><![CDATA[.shape {
  shape-rendering: geometricPrecision;
  stroke-linejoin: round;
}
.connection {
  stroke-linecap: round;
  stroke-linejoin: round;
}
.blend {
  mix-blend-mode: multiply;
  opacity: 0.5;
}

		.d2-1566166734 .fill-N1{fill:#0A0F25;}
		.d2-1566166734 .fill-N2{fill:#676C7E;}
		.d2-1566166734 .fill-N3{fill:#9499AB;}
		.d2-1566166734 .fill-N4{fill:#CFD2DD;}
		.d2-1566166734 .fill-N5{fill:#DEE1EB;}
		.d2-1566166734 .fill-N6{fill:#EEF1F8;}
		.d2-1566166734 .fill-N7{fill:#FFFFFF;}
		.d2-1566166734 .fill-B1{fill:#0D32B2;}
		.d2-1566166734 .fill-B2{fill:#0D32B2;}
		.d2-1566166734 .fill-B3{fill:#E3E9FD;}
		.d2-1566166734 .fill-B4{fill:#E3E9FD;}
		.d2-1566166734 .fill-B5{fill:#EDF0FD;}
		.d2-1566166734 .fill-B6{fill:#F7F8FE;}
		.d2-1566166734 .fill-AA2{fill:#4A6FF3;}
		.d2-1566166734 .fill-AA4{fill:#EDF0FD;}
		.d2-1566166734 .fill-AA5{fill:#F7F8FE;}
		.d2-1566166734 .fill-AB4{fill:#EDF0FD;}
		.d2-1566166734 .fill-AB5{fill:#F7F8FE;}
		.d2-1566166734 .stroke-N1{stroke:#0A0F25;}
		.d2-1566166734 .stroke-N2{stroke:#676C7E;}
		.d2-1566166734 .stroke-N3{stroke:#9499AB;}
		.d2-1566166734 .stroke-N4{stroke:#CFD2DD;}
		.d2-1566166734 .stroke-N5{stroke:#DEE1EB;}
		.d2-1566166734 .stroke-N6{stroke:#EEF1F8;}
		.d2-1566166734 .stroke-N7{stroke:#FFFFFF;}
		.d2-1566166734 .stroke-B1{stroke:#0D32B2;}
		.d2-1566166734 .stroke-B2{stroke:#0D32B2;}
		.d2-1566166734 .stroke-B3{stroke:#E3E9FD;}
		.d2-1566166734 .stroke-B4{stroke:#E3E9FD;}
		.d2-1566166734 .stroke-B5{stroke:#EDF0FD;}
		.d2-1566166734 .stroke-B6{stroke:#F7F8FE;}
		.d2-1566166734 .stroke-AA2{stroke:#4A6FF3;}
		.d2-1566166734 .stroke-AA4{stroke:#EDF0FD;}
		.d2-1566166734 .stroke-AA5{stroke:#F7F8FE;}
		.d2-1566166734 .stroke-AB4{stroke:#EDF0FD;}
		.d2-1566166734 .stroke-AB5{stroke:#F7F8FE;}
		.d2-1566166734 .background-color-N1{background-color:#0A0F25;}
		.d2-1566166734 .background-color-N2{background-color:#676C7E;}
		.d2-1566166734 .background-color-N3{background-color:#9499AB;}
		.d2-1566166734 .background-color-N4{background-color:#CFD2DD;}
		.d2-1566166734 .background-color-N5{background-color:#DEE1EB;}
		.d2-1566166734 .background-color-N6{background-color:#EEF1F8;}
		.d2-1566166734 .background-color-N7{background-color:#FFFFFF;}
		.d2-1566166734 .background-color-B1{background-color:#0D32B2;}
		.d2-1566166734 .background-color-B2{background-color:#0D32B2;}
		.d2-1566166734 .background-color-B3{background-color:#E3E9FD;}
		.d2-1566166734 .background-color-B4{background-color:#E3E9FD;}
		.d2-1566166734 .background-color-B5{background-color:#EDF0FD;}
		.d2-1566166734 .background-color-B6{background-color:#F7F8FE;}
		.d2-1566166734 .background-color-AA2{background-color:#4A6FF3;}
		.d2-1566166734 .background-color-AA4{background-color:#EDF0FD;}
		.d2-1566166734 .background-color-AA5{background-color:#F7F8FE;}
		.d2-1566166734 .background-color-AB4{background-color:#EDF0FD;}
		.d2-1566166734 .background-color-AB5{background-color:#F7F8FE;}
		.d2-1566166734 .color-N1{color:#0A0F25;}
		.d2-1566166734 .color-N2{color:#676C7E;}
		.d2-1566166734 .color-N3{color:#9499AB;}
		.d2-1566166734 .color-N4{color:#CFD2DD;}
		.d2-1566166734 .color-N5{color:#DEE1EB;}
		.d2-1566166734 .color-N6{color:#EEF1F8;}
		.d2-1566166734 .color-N7{color:#FFFFFF;}
		.d2-1566166734 .color-B1{color:#0D32B2;}
		.d2-1566166734 .color-B2{color:#0D32B2;}
		.d2-1566166734 .color-B3{color:#E3E9FD;}
		.d2-1566166734 .color-B4{color:#E3E9FD;}
		.d2-1566166734 .color-B5{color:#EDF0FD;}
		.d2-1566166734 .color-B6{color:#F7F8FE;}
		.d2-1566166734 .color-AA2{color:#4A6FF3;}
		.d2-1566166734 .color-AA4{color:#EDF0FD;}
		.d2-1566166734 .color-AA5{color:#F7F8FE;}
		.d2-1566166734 .color-AB4{color:#EDF0FD;}
		.d2-1566166734 .color-AB5{color:#F7F8FE;}.appendix text.text{fill:#0A0F25}.md{--color-fg-default:#0A0F25;--color-fg-muted:#676C7E;--color-fg-subtle:#9499AB;--color-canvas-default:#FFFFFF;--color-canvas-subtle:#EEF1F8;--color-border-default:#0D32B2;--color-border-muted:#0D32B2;--color-neutral-muted:#EEF1F8;--color-accent-fg:#0D32B2;--color-accent-emphasis:#0D32B2;--color-attention-subtle:#676C7E;--color-danger-fg:red;}.sketch-overlay-B1{fill:url(#streaks-darker-d2-1566166734);mix-blend-mode:lighten}.sketch-overlay-B2{fill:url(#streaks-darker-d2-1566166734);mix-blend-mode:lighten}.sketch-overlay-B3{fill:url(#streaks-bright-d2-1566166734);mix-blend-mode:darken}.sketch-overlay-B4{fill:url(#streaks-bright-d2-1566166734);mix-blend-mode:darken}.sketch-overlay-B5{fill:url(#streaks-bright-d2-1566166734);mix-blend-mode:darken}.sketch-overlay-B6{fill:url(#streaks-bright-d2-1566166734);mix-blend-mode:darken}.sketch-overlay-AA2{fill:url(#streaks-dark-d2-1566166734);mix-blend-mode:overlay}.sketch-overlay-AA4{fill:url(#streaks-bright-d2-1566166734);mix-blend-mode:darken}.sketch-overlay-AA5{fill:url(#streaks-bright-d2-1566166734);mix-blend-mode:darken}.sketch-overlay-AB4{fill:url(#streaks-bright-d2-1566166734);mix-blend-mode:darken}.sketch-overlay-AB5{fill:url(#streaks-bright-d2-1566166734);mix-blend-mode:darken}.sketch-overlay-N1{fill:url(#streaks-darker-d2-1566166734);mix-blend-mode:lighten}.sketch-overlay-N2{fill:url(#streaks-dark-d2-1566166734);mix-blend-mode:overlay}.sketch-overlay-N3{fill:url(#streaks-normal-d2-1566166734);mix-blend-mode:color-burn}.sketch-overlay-N4{fill:url(#streaks-normal-d2-1566166734);mix-blend-mode:color-burn}.sketch-overlay-N5{fill:url(#streaks-bright-d2-1566166734);mix-blend-mode:darken}.sketch-overlay-N6{fill:url(#streaks-bright-d2-1566166734);mix-blend-mode:darken}.sketch-overlay-N7{fill:url(#streaks-bright-d2-1566166734);mix-blend-mode:darken}.light-code{display: block}.dark-code{display: none}]]></style><g class="Y2g="><g class="shape" ><rect x="368.000000" y="56.000000" width="822.000000" height="178.000000" stroke="#0D32B2" fill="#E3E9FD" class=" stroke-B1 fill-B4" style="stroke-width:2;" /></g><text x="779.000000" y="43.000000" fill="#0A0F25" class="text fill-N1" style="text-anchor:middle;font-size:28px">Clearinghouse</text></g><g class="Yw=="><g class="shape" ><rect x="0.000000" y="112.000000" width="120.000000" height="66.000000" stroke="#0D32B2" fill="#F7F8FE" class=" stroke-B1 fill-B6" style="stroke-width:2;" /></g><text x="60.000000" y="150.500000" fill="#0A0F25" class="text-bold fill-N1" style="text-anchor:middle;font-size:16px">Connector</text></g><g class="Y2guY2hh"><g class="shape" ><rect x="741.000000" y="112.000000" width="180.000000" height="66.000000" stroke="#0D32B2" fill="#EDF0FD" class=" stroke-B1 fill-B5" style="stroke-width:2;" /></g><text x="831.000000" y="150.500000" fill="#0A0F25" class="text-bold fill-N1" style="text-anchor:middle;font-size:16px">Clearinghouse-App</text></g><g class="Y2guY2hl"><g class="shape" ><rect x="398.000000" y="112.000000" width="180.000000" height="66.000000" stroke="#0D32B2" fill="#EDF0FD" class=" stroke-B1 fill-B5" style="stroke-width:2;" /></g><text x="488.000000" y="150.500000" fill="#0A0F25" class="text-bold fill-N1" style="text-anchor:middle;font-size:16px">Clearinghouse-EDC</text></g><g class="Y2gubQ=="><g class="shape" ><path d="M 1048 110 C 1048 86 1098 86 1104 86 C 1110 86 1160 86 1160 110 V 180 C 1160 204 1110 204 1104 204 C 1098 204 1048 204 1048 180 V 110 Z" stroke="#0D32B2" fill="#F7F8FE" class=" stroke-B1 fill-AA5" style="stroke-width:2;" /><path d="M 1048 110 C 1048 134 1098 134 1104 134 C 1110 134 1160 134 1160 110" stroke="#0D32B2" fill="#F7F8FE" class=" stroke-B1 fill-AA5" style="stroke-width:2;" /></g><text x="1104.000000" y="162.500000" fill="#0A0F25" class="text-bold fill-N1" style="text-anchor:middle;font-size:16px">MongoDB</text></g><g class="Y2guKGNoZSAtJmd0OyBjaGEpWzBd"><marker id="mk-d2-1566166734-3488378134" markerWidth="10.000000" markerHeight="12.000000" refX="7.000000" refY="6.000000" viewBox="0.000000 0.000000 10.000000 12.000000" orient="auto" markerUnits="userSpaceOnUse"> <polygon points="0.000000,0.000000 10.000000,6.000000 0.000000,12.000000" fill="#0D32B2" class="connection fill-B1" stroke-width="2" /> </marker><path d="M 580.500000 145.000000 C 642.900024 145.000000 675.299988 145.000000 736.500000 145.000000" stroke="#0D32B2" fill="none" class="connection stroke-B1" style="stroke-width:2;" marker-end="url(#mk-d2-1566166734-3488378134)" mask="url(#d2-1566166734)" /><text x="660.000000" y="151.000000" fill="#676C7E" class="text-italic fill-N2" style="text-anchor:middle;font-size:16px">REST</text></g><g class="Y2guKGNoYSAtJmd0OyBtKVswXQ=="><path d="M 923.500000 145.000000 C 971.500000 145.000000 996.799988 145.000000 1044.000000 145.000000" stroke="#0D32B2" fill="none" class="connection stroke-B1" style="stroke-width:2;" marker-end="url(#mk-d2-1566166734-3488378134)" mask="url(#d2-1566166734)" /></g><g class="KGMgLSZndDsgY2gpWzBd"><path d="M 122.000000 145.000000 C 205.600006 145.000000 255.199997 145.000000 364.000000 145.000000" stroke="#0D32B2" fill="none" class="connection stroke-B1" style="stroke-width:2;" marker-end="url(#mk-d2-1566166734-3488378134)" mask="url(#d2-1566166734)" /><text x="244.500000" y="151.000000" fill="#676C7E" class="text-italic fill-N2" style="text-anchor:middle;font-size:16px">IDS Multipart</text></g><mask id="d2-1566166734" maskUnits="userSpaceOnUse" x="-101" y="-85" width="1392" height="420">
<rect x="-101" y="-85" width="1392" height="420" fill="white"></rect>
<rect x="695.500000" y="15.000000" width="167" height="36" fill="rgba(0,0,0,0.75)"></rect>
<rect x="22.500000" y="134.500000" width="75" height="21" fill="rgba(0,0,0,0.75)"></rect>
<rect x="763.500000" y="134.500000" width="135" height="21" fill="rgba(0,0,0,0.75)"></rect>
<rect x="420.500000" y="134.500000" width="135" height="21" fill="rgba(0,0,0,0.75)"></rect>
<rect x="1070.500000" y="146.500000" width="67" height="21" fill="rgba(0,0,0,0.75)"></rect>
<rect x="642.000000" y="135.000000" width="36" height="21" fill="black"></rect>
<rect x="201.000000" y="135.000000" width="87" height="21" fill="black"></rect>
</mask></svg></svg>
</pre>
<blockquote>
<p><strong>Short history lesson</strong></p>
<p>The clearinghouse-app consisted before out of three separate microservices - logging, keyring, document - which were merged into one service. The reason for this is that the services were too tightly coupled and there was no benefit in having them separated. The new service is called just “clearinghouse-app”.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="communication"><a class="header" href="#communication">Communication</a></h1>
<p>The APIs are documented in the following dscriptions:</p>
<ul>
<li>Connector to Clearinghouse: <a href="https://github.com/International-Data-Spaces-Association/IDS-G/tree/main/Communication/protocols/multipart">IDS-G</a></li>
<li>Clearinghouse to Clearinghouse-App: <a href="https://github.com/truzzt/ids-basecamp-clearinghouse-postman/blob/main/index.yaml">OpenAPI</a></li>
</ul>
<p>The following section contains examples of the communication between the components.</p>
<h2 id="connector-to-clearinghouse-edc"><a class="header" href="#connector-to-clearinghouse-edc">Connector to Clearinghouse-EDC</a></h2>
<p>The Clearinghouse-EDC received IDS-Multipart messages of the type <code>ids:LogMessage</code> in the <em>header</em> and an arbitrary <em>payload</em>. The following shows an example of a multipart message:</p>
<pre><code>POST /messages/log/1 HTTP/1.1
Host: ch-ids.aisec.fraunhofer.de
Content-Type: multipart/form-data; boundary=X-TEST-REQUEST-BOUNDARY
Accept: */*

--X-TEST-REQUEST-BOUNDARY
Content-Disposition: form-data; name="header"
Content-Type: application/json
{
  "@context" : {
    "ids" : "https://w3id.org/idsa/core/",
    "idsc" : "https://w3id.org/idsa/code/"
  },
  "@type" : "ids:LogMessage",
  "@id" : "https://w3id.org/idsa/autogen/logMessage/c6c15a90-7799-4aa1-ac21-9323b87a7xv9",
  "ids:securityToken" : {
    "@type" : "ids:DynamicAttributeToken",
    "@id" : "https://w3id.org/idsa/autogen/dynamicAttributeToken/6378asd9-480d-80df-c5cb02e4e260",
    "ids:tokenFormat" : {
      "@id" : "idsc:JWT"
    },
    "ids:tokenValue" : "eyJ0eXAiOiJKV1QiLCJraWQiOiJkZWZhdWx0IiwiYWxnIjoi....."
  },
  "ids:senderAgent" : "http://example.org",
  "ids:modelVersion" : "4.1.0",
  "ids:issued" : {
    "@value" : "2020-12-14T08:57:57.057+01:00",
    "@type" : "http://www.w3.org/2001/XMLSchema#dateTimeStamp"
  },
  "ids:issuerConnector" : {
    "@id" : "https://companyA.com/connector/59a68243-dd96-4c8d-88a9-0f0e03e13b1b"
  }
}
--X-TEST-REQUEST-BOUNDARY
Content-Disposition: form-data; name="payload"
Content-Type: application/json
{
  "@context" : "https://w3id.org/idsa/contexts/context.jsonld",
  "@type" : "ids:ConnectorUpdateMessage",
  "id" : "http://industrialdataspace.org/connectorAvailableMessage/34d761cf-5ca4-4a77-a7f4-b14d8f75636a",
  "issued" : "2019-12-02T08:25:08.245Z",
  "modelVersion" : "4.1.0",
  "issuerConnector" : "https://companyA.com/connector/59a68243-dd96-4c8d-88a9-0f0e03e13b1b",
  "securityToken" : {
    "@type" : "ids:DynamicAttributeToken",
    "tokenFormat" : "https://w3id.org/idsa/code/tokenformat/JWT",
    "tokenValue" : "eyJhbGciOiJSUzI1NiIsInR5cCI..."
}
--X-TEST-REQUEST-BOUNDARY--
</code></pre>
<h2 id="clearinghouse-edc-to-clearinghouse-app"><a class="header" href="#clearinghouse-edc-to-clearinghouse-app">Clearinghouse-EDC to Clearinghouse-App</a></h2>
<p>The Clearinghouse-EDC extracts the <em>header</em> and <em>payload</em> and forwards it to the Clearinghouse-App via REST. The message looks like this:</p>
<pre><code class="language-json">{
    "header": {
        "@context" : {
            "ids" : "https://w3id.org/idsa/core/",
            "idsc" : "https://w3id.org/idsa/code/"
        },
        "@type" : "ids:LogMessage",
        "@id" : "https://w3id.org/idsa/autogen/logMessage/c6c15a90-7799-4aa1-ac21-9323b87a7xv9",
        "ids:securityToken" : {
            "@type" : "ids:DynamicAttributeToken",
            "@id" : "https://w3id.org/idsa/autogen/dynamicAttributeToken/6378asd9-480d-80df-c5cb02e4e260",
            "ids:tokenFormat" : {
            "@id" : "idsc:JWT"
            },
            "ids:tokenValue" : "eyJ0eXAiOiJKV1QiLCJraWQiOiJkZWZhdWx0IiwiYWxnIjoi....."
        },
        "ids:senderAgent" : "http://example.org",
        "ids:modelVersion" : "4.1.0",
        "ids:issued" : {
            "@value" : "2020-12-14T08:57:57.057+01:00",
            "@type" : "http://www.w3.org/2001/XMLSchema#dateTimeStamp"
        },
        "ids:issuerConnector" : {
            "@id" : "https://companyA.com/connector/59a68243-dd96-4c8d-88a9-0f0e03e13b1b"
        }
    },
    "payload": {
        "@context" : "https://w3id.org/idsa/contexts/context.jsonld",
        "@type" : "ids:ConnectorUpdateMessage",
        "id" : "http://industrialdataspace.org/connectorAvailableMessage/34d761cf-5ca4-4a77-a7f4-b14d8f75636a",
        "issued" : "2019-12-02T08:25:08.245Z",
        "modelVersion" : "4.1.0",
        "issuerConnector" : "https://companyA.com/connector/59a68243-dd96-4c8d-88a9-0f0e03e13b1b",
        "securityToken" : {
            "@type" : "ids:DynamicAttributeToken",
            "tokenFormat" : "https://w3id.org/idsa/code/tokenformat/JWT",
            "tokenValue" : "eyJhbGciOiJSUzI1NiIsInR5cCI..."
        }
    }
}
</code></pre>
<h2 id="clearinghouse-app-to-clearinghouse-edc"><a class="header" href="#clearinghouse-app-to-clearinghouse-edc">Clearinghouse-App to Clearinghouse-EDC</a></h2>
<pre><code class="language-json">{
    "data": "eyJhbGciOiJQUzUxMiIsImtpZCI6IlFyYS8vMjlGcnhiajVoaDVBemVmK0czNlNlaU9tOXE3czgrdzh1R0xEMjgifQ.eyJ0cmFuc2FjdGlvbl9pZCI6IjAwMDAwMDAwIiwidGltZXN0YW1wIjoxNjk2NDExMTM2LCJwcm9jZXNzX2lkIjoiMSIsImRvY3VtZW50X2lkIjoiNmNkNDQwNjQtZWFjNi00NmQzLWFhZTUtODcxYjgwYjU4OWMxIiwicGF5bG9hZCI6Int9IiwiY2hhaW5faGFzaCI6IjAiLCJjbGllbnRfaWQiOiJGNjoyNTo1ODpDNTo2MTo2ODo3QToyMTpGMTo0MDo5Rjo0RTpGQjo5NTpEQjo5OTo4ODpDOTpBNzoxQTpDNTpGODpCRjo0Qzo1NToxODo1NjozNTozNTo0MzpDNTpEQzo5NDpCNTpFQjo0NTozMDpGNTpBRjpDRSIsImNsZWFyaW5nX2hvdXNlX3ZlcnNpb24iOiIwLjEwLjAifQ.eo1KoF9gAZLF7CuhuQ-Sd9WSjw6dvDsrmM8w-A-FdTl4cOaPqp75k9O0tKxY8_ZNBsWmOzBzAfGng6YdvpDHIw9xFZTA7N_UMjTrrPuc8ehrVO2rwltTKb8N2bK4bQ4_Uq22Kd8mSFI6IyOZ7KeTkZ_iN30PXlYFAdt2GQHoT7xNERyQbHNEkJmOgGnaraMv0xEbl2zJktQqkTH9Kk4ZF2T_GbxKInhVxUhOsJ707ZeQ2Nxk4H6yO2RXwG5yKXFkwBDOMLg1f0Dnrgz_H1f-fQ7gPOrAL_4G4L7M9o7EVkMJlMpJR1xNBCeYbT_IvfL1CB5gi1NF-VNzt-8Zg5Yj-vNNR9j38yZTe6vH2dMkGl20B99KrEKTjkyVkCUIKnlb3oEKldse0E4ouw9v6WnIWq33-KnGV0ajwZrs13bQLZyLWvdNCBmYA5NujzbqOGkDROXloAB6MXBm5KiGTU8FxrqS6s_J7OW1CLTlAlTFF_U2Tr1xSvcusnpOGrU22IrCuqVuGCNNGCrPYjKJmMc05wIG0cmdxTdRnoe8R-vOVg2Zd07jdrBLX5l5tZtF60LC8DZKw4k2JaCu37W_dXdWHLSXEnpR9MGgnqC8MbOAMIIzSXpWKFdXcS-86SkgTvDA16geN_Bj7Ac6xcuUnEhM3_9tVnpjNMgPcStyO0KiP3c"
}
</code></pre>
<h2 id="clearinghouse-edc-to-connector"><a class="header" href="#clearinghouse-edc-to-connector">Clearinghouse-EDC to Connector</a></h2>
<pre><code>--Boundary_1_377557244_1696411137008
Content-Type: application/json
Content-Disposition: form-data; name="header"

{
    "@context": {
        "ids": "https://w3id.org/idsa/core/",
        "idsc": "https://w3id.org/idsa/code/"
    },
    "@id": "urn:message:92a2da5a-b5de-4709-bda9-c16a0ae293f6",
    "@type": "ids:MessageProcessedNotificationMessage",
    "ids:securityToken": {
        "@id": "https://w3id.org/idsa/autogen/dynamicAttributeToken/6378asd9-480d-80df-c5cb02e4e260",
        "@type": "ids:DynamicAttributeToken",
        "ids:tokenFormat": {
            "@id": "idsc:JWT"
        },
        "ids:tokenValue": "eyJ0eXAiOiJhdCtqd3QiLCJraWQiOiJkNzRlYzU1MGY0MzkxYTAwZGIwODA5Mzg5MjdjOGU4YWQ0NjE3NmM4NGQ3MzhkZGMwODM1ODMzYzM5YWJkMzRhIiwiYWxnIjoiUlMyNTYifQ.eyJzY29wZSI6Imlkc2M6SURTX0NPTk5FQ1RPUl9BVFRSSUJVVEVTX0FMTCIsImF1ZCI6WyJpZHNjOklEU19DT05ORUNUT1JTX0FMTCJdLCJpc3MiOiJkYXBzLmRlbW8udHJ1enp0cG9ydC5jb20iLCJzdWIiOiJGNjoyNTo1ODpDNTo2MTo2ODo3QToyMTpGMTo0MDo5Rjo0RTpGQjo5NTpEQjo5OTo4ODpDOTpBNzoxQTpDNTpGODpCRjo0Qzo1NToxODo1NjozNTozNTo0MzpDNTpEQzo5NDpCNTpFQjo0NTozMDpGNTpBRjpDRSIsIm5iZiI6MTY5NjQxMTAxNiwiaWF0IjoxNjk2NDExMDE2LCJqdGkiOiI0MjY2OTY0NC01MzgzLTQ2NDYtYmMxMC0zMzJlMzRkMjdmNGMiLCJleHAiOjE2OTY0MTQ2MTYsImNsaWVudF9pZCI6IkY2OjI1OjU4OkM1OjYxOjY4OjdBOjIxOkYxOjQwOjlGOjRFOkZCOjk1OkRCOjk5Ojg4OkM5OkE3OjFBOkM1OkY4OkJGOjRDOjU1OjE4OjU2OjM1OjM1OjQzOkM1OkRDOjk0OkI1OkVCOjQ1OjMwOkY1OkFGOkNFIn0.sa2zCMCwap7KjqV6RkzQ4jeR-nMPXo546oqxSzyZSPamhfkPc35LfldZTkuX_gxy6P1Ra2ltrannQTH7467FC8H00giF3mamZ_LuyUHMRUZzab0UvNJaGqt1mJZaMiOnupixP1cUhsXszfmCRKXWvatbwvlc0nhw5gdO2lH_njWBrXUy5Bt2MIIFp892ijf_rP5KC7yfa0cW9lwTFuWZYMMRBeOfY_g1Mx_YVkQXy9mFI0x3zC6rms8jq8OWRompNfkQ7mZsiFPAafls2f0iP8M2HKWA8JeOG5rkAIw0ESWSVT7iB-oV50LlX7L7zAYVLGdDyM3s_khDNxrbvlW_bQ"
    },
    "ids:issuerConnector": {
        "@id": "urn:connector:example-connector"
    },
    "ids:modelVersion": "4.1.3",
    "ids:issued": {
        "@value": "2023-10-04T09:18:56.998Z",
        "@type": "http://www.w3.org/2001/XMLSchema#dateTimeStamp"
    },
    "ids:senderAgent": {
        "@id": "urn:connector:example-connector"
    }
}
--Boundary_1_377557244_1696411137008
Content-Type: application/json
Content-Disposition: form-data; name="payload"

{
    "data": "eyJhbGciOiJQUzUxMiIsImtpZCI6IlFyYS8vMjlGcnhiajVoaDVBemVmK0czNlNlaU9tOXE3czgrdzh1R0xEMjgifQ.eyJ0cmFuc2FjdGlvbl9pZCI6IjAwMDAwMDAwIiwidGltZXN0YW1wIjoxNjk2NDExMTM2LCJwcm9jZXNzX2lkIjoiMSIsImRvY3VtZW50X2lkIjoiNmNkNDQwNjQtZWFjNi00NmQzLWFhZTUtODcxYjgwYjU4OWMxIiwicGF5bG9hZCI6Int9IiwiY2hhaW5faGFzaCI6IjAiLCJjbGllbnRfaWQiOiJGNjoyNTo1ODpDNTo2MTo2ODo3QToyMTpGMTo0MDo5Rjo0RTpGQjo5NTpEQjo5OTo4ODpDOTpBNzoxQTpDNTpGODpCRjo0Qzo1NToxODo1NjozNTozNTo0MzpDNTpEQzo5NDpCNTpFQjo0NTozMDpGNTpBRjpDRSIsImNsZWFyaW5nX2hvdXNlX3ZlcnNpb24iOiIwLjEwLjAifQ.eo1KoF9gAZLF7CuhuQ-Sd9WSjw6dvDsrmM8w-A-FdTl4cOaPqp75k9O0tKxY8_ZNBsWmOzBzAfGng6YdvpDHIw9xFZTA7N_UMjTrrPuc8ehrVO2rwltTKb8N2bK4bQ4_Uq22Kd8mSFI6IyOZ7KeTkZ_iN30PXlYFAdt2GQHoT7xNERyQbHNEkJmOgGnaraMv0xEbl2zJktQqkTH9Kk4ZF2T_GbxKInhVxUhOsJ707ZeQ2Nxk4H6yO2RXwG5yKXFkwBDOMLg1f0Dnrgz_H1f-fQ7gPOrAL_4G4L7M9o7EVkMJlMpJR1xNBCeYbT_IvfL1CB5gi1NF-VNzt-8Zg5Yj-vNNR9j38yZTe6vH2dMkGl20B99KrEKTjkyVkCUIKnlb3oEKldse0E4ouw9v6WnIWq33-KnGV0ajwZrs13bQLZyLWvdNCBmYA5NujzbqOGkDROXloAB6MXBm5KiGTU8FxrqS6s_J7OW1CLTlAlTFF_U2Tr1xSvcusnpOGrU22IrCuqVuGCNNGCrPYjKJmMc05wIG0cmdxTdRnoe8R-vOVg2Zd07jdrBLX5l5tZtF60LC8DZKw4k2JaCu37W_dXdWHLSXEnpR9MGgnqC8MbOAMIIzSXpWKFdXcS-86SkgTvDA16geN_Bj7Ac6xcuUnEhM3_9tVnpjNMgPcStyO0KiP3c"
}
--Boundary_1_377557244_1696411137008--
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="functionality"><a class="header" href="#functionality">Functionality</a></h1>
<h2 id="logging-a-message"><a class="header" href="#logging-a-message">Logging a message</a></h2>
<p>The logging service (as an entity inside the remaining clearinghouse-app) is responsible for orchestrating the flow between document service and keyring service:</p>
<p>When logging a message, the message consists of two parts, originating from the IDS communication structure. There is a <code>header</code> and a <code>payload</code>.</p>
<p>The logging service creates a process id (if not exists) and checks the authorization.</p>
<p>After all prerequisites are checked and completed, the logging-service  merges <code>header</code> and <code>payload</code> into a Document starts to get the transaction counter and assigns it to the Document.</p>
<p>Now the document service comes into play: First checking if the document exists already, then requesting the keyring service to generate a key map for the document. The key map is then used to encrypt the document (back in the document service) and then the document is stored in the database.</p>
<p>Finally the transaction counter is incremented and a reciept is signed and send back to the Clearinghouse-EDC.</p>
<h3 id="encryption"><a class="header" href="#encryption">Encryption</a></h3>
<p>There is a randomly generated Master Key stored in the database.</p>
<p>Each document has a number of fields. For each document a random secret is generated. This secret is used to derive multiple secrets with the HKDF Algorithm from the original secret. These derived secrets are used to encrypt the fields of the document with AES-256-GCM-SIV.</p>
<p>The original secret is encrypted also with AES-256-GCM-SIV with a derived key from the Master Key and stored in the database alongside the Document.</p>
<h3 id="detailed-internal-diagram"><a class="header" href="#detailed-internal-diagram">Detailed internal diagram</a></h3>
<pre><?xml version="1.0" encoding="utf-8"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" data-d2-version="v0.6.9" preserveAspectRatio="xMinYMin meet" viewBox="0 0 1052 3139"><svg class="d2-1465926647 d2-svg" width="1052" height="3139" viewBox="-101 -121 1052 3139"><rect x="-101.000000" y="-121.000000" width="1052.000000" height="3139.000000" rx="0.000000" fill="#FFFFFF" class=" fill-N7" stroke-width="0" /><style type="text/css"><![CDATA[
.d2-1465926647 .text {
	font-family: "d2-1465926647-font-regular";
}
@font-face {
	font-family: d2-1465926647-font-regular;
	src: url("data:application/font-woff;base64,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");
}
.d2-1465926647 .text-bold {
	font-family: "d2-1465926647-font-bold";
}
@font-face {
	font-family: d2-1465926647-font-bold;
	src: url("data:application/font-woff;base64,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");
}
.d2-1465926647 .text-italic {
	font-family: "d2-1465926647-font-italic";
}
@font-face {
	font-family: d2-1465926647-font-italic;
	src: url("data:application/font-woff;base64,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");
}]]></style><style type="text/css"><![CDATA[.shape {
  shape-rendering: geometricPrecision;
  stroke-linejoin: round;
}
.connection {
  stroke-linecap: round;
  stroke-linejoin: round;
}
.blend {
  mix-blend-mode: multiply;
  opacity: 0.5;
}

		.d2-1465926647 .fill-N1{fill:#0A0F25;}
		.d2-1465926647 .fill-N2{fill:#676C7E;}
		.d2-1465926647 .fill-N3{fill:#9499AB;}
		.d2-1465926647 .fill-N4{fill:#CFD2DD;}
		.d2-1465926647 .fill-N5{fill:#DEE1EB;}
		.d2-1465926647 .fill-N6{fill:#EEF1F8;}
		.d2-1465926647 .fill-N7{fill:#FFFFFF;}
		.d2-1465926647 .fill-B1{fill:#0D32B2;}
		.d2-1465926647 .fill-B2{fill:#0D32B2;}
		.d2-1465926647 .fill-B3{fill:#E3E9FD;}
		.d2-1465926647 .fill-B4{fill:#E3E9FD;}
		.d2-1465926647 .fill-B5{fill:#EDF0FD;}
		.d2-1465926647 .fill-B6{fill:#F7F8FE;}
		.d2-1465926647 .fill-AA2{fill:#4A6FF3;}
		.d2-1465926647 .fill-AA4{fill:#EDF0FD;}
		.d2-1465926647 .fill-AA5{fill:#F7F8FE;}
		.d2-1465926647 .fill-AB4{fill:#EDF0FD;}
		.d2-1465926647 .fill-AB5{fill:#F7F8FE;}
		.d2-1465926647 .stroke-N1{stroke:#0A0F25;}
		.d2-1465926647 .stroke-N2{stroke:#676C7E;}
		.d2-1465926647 .stroke-N3{stroke:#9499AB;}
		.d2-1465926647 .stroke-N4{stroke:#CFD2DD;}
		.d2-1465926647 .stroke-N5{stroke:#DEE1EB;}
		.d2-1465926647 .stroke-N6{stroke:#EEF1F8;}
		.d2-1465926647 .stroke-N7{stroke:#FFFFFF;}
		.d2-1465926647 .stroke-B1{stroke:#0D32B2;}
		.d2-1465926647 .stroke-B2{stroke:#0D32B2;}
		.d2-1465926647 .stroke-B3{stroke:#E3E9FD;}
		.d2-1465926647 .stroke-B4{stroke:#E3E9FD;}
		.d2-1465926647 .stroke-B5{stroke:#EDF0FD;}
		.d2-1465926647 .stroke-B6{stroke:#F7F8FE;}
		.d2-1465926647 .stroke-AA2{stroke:#4A6FF3;}
		.d2-1465926647 .stroke-AA4{stroke:#EDF0FD;}
		.d2-1465926647 .stroke-AA5{stroke:#F7F8FE;}
		.d2-1465926647 .stroke-AB4{stroke:#EDF0FD;}
		.d2-1465926647 .stroke-AB5{stroke:#F7F8FE;}
		.d2-1465926647 .background-color-N1{background-color:#0A0F25;}
		.d2-1465926647 .background-color-N2{background-color:#676C7E;}
		.d2-1465926647 .background-color-N3{background-color:#9499AB;}
		.d2-1465926647 .background-color-N4{background-color:#CFD2DD;}
		.d2-1465926647 .background-color-N5{background-color:#DEE1EB;}
		.d2-1465926647 .background-color-N6{background-color:#EEF1F8;}
		.d2-1465926647 .background-color-N7{background-color:#FFFFFF;}
		.d2-1465926647 .background-color-B1{background-color:#0D32B2;}
		.d2-1465926647 .background-color-B2{background-color:#0D32B2;}
		.d2-1465926647 .background-color-B3{background-color:#E3E9FD;}
		.d2-1465926647 .background-color-B4{background-color:#E3E9FD;}
		.d2-1465926647 .background-color-B5{background-color:#EDF0FD;}
		.d2-1465926647 .background-color-B6{background-color:#F7F8FE;}
		.d2-1465926647 .background-color-AA2{background-color:#4A6FF3;}
		.d2-1465926647 .background-color-AA4{background-color:#EDF0FD;}
		.d2-1465926647 .background-color-AA5{background-color:#F7F8FE;}
		.d2-1465926647 .background-color-AB4{background-color:#EDF0FD;}
		.d2-1465926647 .background-color-AB5{background-color:#F7F8FE;}
		.d2-1465926647 .color-N1{color:#0A0F25;}
		.d2-1465926647 .color-N2{color:#676C7E;}
		.d2-1465926647 .color-N3{color:#9499AB;}
		.d2-1465926647 .color-N4{color:#CFD2DD;}
		.d2-1465926647 .color-N5{color:#DEE1EB;}
		.d2-1465926647 .color-N6{color:#EEF1F8;}
		.d2-1465926647 .color-N7{color:#FFFFFF;}
		.d2-1465926647 .color-B1{color:#0D32B2;}
		.d2-1465926647 .color-B2{color:#0D32B2;}
		.d2-1465926647 .color-B3{color:#E3E9FD;}
		.d2-1465926647 .color-B4{color:#E3E9FD;}
		.d2-1465926647 .color-B5{color:#EDF0FD;}
		.d2-1465926647 .color-B6{color:#F7F8FE;}
		.d2-1465926647 .color-AA2{color:#4A6FF3;}
		.d2-1465926647 .color-AA4{color:#EDF0FD;}
		.d2-1465926647 .color-AA5{color:#F7F8FE;}
		.d2-1465926647 .color-AB4{color:#EDF0FD;}
		.d2-1465926647 .color-AB5{color:#F7F8FE;}.appendix text.text{fill:#0A0F25}.md{--color-fg-default:#0A0F25;--color-fg-muted:#676C7E;--color-fg-subtle:#9499AB;--color-canvas-default:#FFFFFF;--color-canvas-subtle:#EEF1F8;--color-border-default:#0D32B2;--color-border-muted:#0D32B2;--color-neutral-muted:#EEF1F8;--color-accent-fg:#0D32B2;--color-accent-emphasis:#0D32B2;--color-attention-subtle:#676C7E;--color-danger-fg:red;}.sketch-overlay-B1{fill:url(#streaks-darker-d2-1465926647);mix-blend-mode:lighten}.sketch-overlay-B2{fill:url(#streaks-darker-d2-1465926647);mix-blend-mode:lighten}.sketch-overlay-B3{fill:url(#streaks-bright-d2-1465926647);mix-blend-mode:darken}.sketch-overlay-B4{fill:url(#streaks-bright-d2-1465926647);mix-blend-mode:darken}.sketch-overlay-B5{fill:url(#streaks-bright-d2-1465926647);mix-blend-mode:darken}.sketch-overlay-B6{fill:url(#streaks-bright-d2-1465926647);mix-blend-mode:darken}.sketch-overlay-AA2{fill:url(#streaks-dark-d2-1465926647);mix-blend-mode:overlay}.sketch-overlay-AA4{fill:url(#streaks-bright-d2-1465926647);mix-blend-mode:darken}.sketch-overlay-AA5{fill:url(#streaks-bright-d2-1465926647);mix-blend-mode:darken}.sketch-overlay-AB4{fill:url(#streaks-bright-d2-1465926647);mix-blend-mode:darken}.sketch-overlay-AB5{fill:url(#streaks-bright-d2-1465926647);mix-blend-mode:darken}.sketch-overlay-N1{fill:url(#streaks-darker-d2-1465926647);mix-blend-mode:lighten}.sketch-overlay-N2{fill:url(#streaks-dark-d2-1465926647);mix-blend-mode:overlay}.sketch-overlay-N3{fill:url(#streaks-normal-d2-1465926647);mix-blend-mode:color-burn}.sketch-overlay-N4{fill:url(#streaks-normal-d2-1465926647);mix-blend-mode:color-burn}.sketch-overlay-N5{fill:url(#streaks-bright-d2-1465926647);mix-blend-mode:darken}.sketch-overlay-N6{fill:url(#streaks-bright-d2-1465926647);mix-blend-mode:darken}.sketch-overlay-N7{fill:url(#streaks-bright-d2-1465926647);mix-blend-mode:darken}.light-code{display: block}.dark-code{display: none}]]></style><g class="bG9n"><g class="shape" ><rect x="183.000000" y="20.000000" width="344.000000" height="671.000000" stroke="#0D32B2" fill="#E3E9FD" class=" stroke-B1 fill-B4" style="stroke-width:2;" /></g><text x="355.000000" y="7.000000" fill="#0A0F25" class="text fill-N1" style="text-anchor:middle;font-size:28px">fn log</text></g><g class="bG0="><g class="shape" ><rect x="0.000000" y="831.000000" width="573.000000" height="1870.000000" stroke="#0D32B2" fill="#E3E9FD" class=" stroke-B1 fill-B4" style="stroke-width:2;" /></g><text x="286.500000" y="818.000000" fill="#0A0F25" class="text fill-N1" style="text-anchor:middle;font-size:28px">fn log_message</text></g><g class="Z2tt"><g class="shape" ><rect x="603.000000" y="2027.000000" width="241.000000" height="890.000000" stroke="#0D32B2" fill="#E3E9FD" class=" stroke-B1 fill-B4" style="stroke-width:2;" /></g><text x="723.500000" y="2014.000000" fill="#0A0F25" class="text fill-N1" style="text-anchor:middle;font-size:28px">fn generate_key_map</text></g><g class="bG9nLmdw"><g class="shape" ><rect x="247.000000" y="50.000000" width="172.000000" height="66.000000" stroke="#0D32B2" fill="#EDF0FD" class=" stroke-B1 fill-B5" style="stroke-width:2;" /></g><text x="333.000000" y="88.500000" fill="#0A0F25" class="text-bold fill-N1" style="text-anchor:middle;font-size:16px">fn db.get_process</text></g><g class="bG9nLmlh"><g class="shape" ><rect x="241.000000" y="595.000000" width="183.000000" height="66.000000" stroke="#0D32B2" fill="#EDF0FD" class=" stroke-B1 fill-B5" style="stroke-width:2;" /></g><text x="332.500000" y="633.500000" fill="#0A0F25" class="text-bold fill-N1" style="text-anchor:middle;font-size:16px">fn db.is_authorized</text></g><g class="bG9nLnNw"><g class="shape" ><rect x="312.000000" y="429.000000" width="185.000000" height="66.000000" stroke="#0D32B2" fill="#EDF0FD" class=" stroke-B1 fill-B5" style="stroke-width:2;" /></g><text x="404.500000" y="467.500000" fill="#0A0F25" class="text-bold fill-N1" style="text-anchor:middle;font-size:16px">fn db.store_process</text></g><g class="bG9nLmRl"><g class="shape" ><path d="M 333 308 C 332 308 331 308 331 308 L 214 263 C 213 263 213 262 214 261 L 331 216 C 332 216 334 216 335 216 L 452 261 C 453 261 453 262 452 263 L 335 308 C 335 308 334 308 333 308 Z" stroke="#0D32B2" fill="#CFD2DD" class=" stroke-B1 fill-N4" style="stroke-width:2;" /></g><text x="333.000000" y="267.500000" fill="#0A0F25" class="text-bold fill-N1" style="text-anchor:middle;font-size:16px">process exists?</text></g><g class="bG0uZ3Q="><g class="shape" ><rect x="201.000000" y="1027.000000" width="263.000000" height="66.000000" stroke="#0D32B2" fill="#EDF0FD" class=" stroke-B1 fill-B5" style="stroke-width:2;" /></g><text x="332.500000" y="1065.500000" fill="#0A0F25" class="text-bold fill-N1" style="text-anchor:middle;font-size:16px">fn db.get_transaction_counter</text></g><g class="bG0uZGY="><g class="shape" ><rect x="216.000000" y="861.000000" width="233.000000" height="66.000000" stroke="#0D32B2" fill="#EDF0FD" class=" stroke-B1 fill-B5" style="stroke-width:2;" /></g><text x="332.500000" y="899.500000" fill="#0A0F25" class="text-bold fill-N1" style="text-anchor:middle;font-size:16px">Document::from(message)</text></g><g class="bG0uY2Vk"><g class="shape" ><rect x="30.000000" y="1213.000000" width="513.000000" height="1272.000000" stroke="#0D32B2" fill="#EDF0FD" class=" stroke-B1 fill-B5" style="stroke-width:2;" /></g><text x="286.500000" y="1201.000000" fill="#0A0F25" class="text fill-N1" style="text-anchor:middle;font-size:24px">fn doc_api.create_encrypted_document</text></g><g class="bG0uaXRj"><g class="shape" ><rect x="130.000000" y="2605.000000" width="313.000000" height="66.000000" stroke="#0D32B2" fill="#EDF0FD" class=" stroke-B1 fill-B5" style="stroke-width:2;" /></g><text x="286.500000" y="2643.500000" fill="#0A0F25" class="text-bold fill-N1" style="text-anchor:middle;font-size:16px">fn db.increment_transaction_counter</text></g><g class="Z2ttLmlr"><g class="shape" ><rect x="645.000000" y="2057.000000" width="157.000000" height="66.000000" stroke="#0D32B2" fill="#EDF0FD" class=" stroke-B1 fill-B5" style="stroke-width:2;" /></g><text x="723.500000" y="2095.500000" fill="#0A0F25" class="text-bold fill-N1" style="text-anchor:middle;font-size:16px">fn initialize_kdf</text></g><g class="Z2ttLmRr"><g class="shape" ><rect x="633.000000" y="2223.000000" width="181.000000" height="66.000000" stroke="#0D32B2" fill="#EDF0FD" class=" stroke-B1 fill-B5" style="stroke-width:2;" /></g><text x="723.500000" y="2261.500000" fill="#0A0F25" class="text-bold fill-N1" style="text-anchor:middle;font-size:16px">fn derive_key_map</text></g><g class="Z2ttLnJr"><g class="shape" ><rect x="650.000000" y="2389.000000" width="147.000000" height="66.000000" stroke="#0D32B2" fill="#EDF0FD" class=" stroke-B1 fill-B5" style="stroke-width:2;" /></g><text x="723.500000" y="2427.500000" fill="#0A0F25" class="text-bold fill-N1" style="text-anchor:middle;font-size:16px">fn restore_kdf</text></g><g class="Z2ttLmtl"><g class="shape" ><rect x="652.000000" y="2605.000000" width="144.000000" height="66.000000" stroke="#0D32B2" fill="#EDF0FD" class=" stroke-B1 fill-B5" style="stroke-width:2;" /></g><text x="724.000000" y="2643.500000" fill="#0A0F25" class="text-bold fill-N1" style="text-anchor:middle;font-size:16px">fn kdf.expand</text></g><g class="Z2ttLmVz"><g class="shape" ><rect x="639.000000" y="2821.000000" width="170.000000" height="66.000000" stroke="#0D32B2" fill="#EDF0FD" class=" stroke-B1 fill-B5" style="stroke-width:2;" /></g><text x="724.000000" y="2859.500000" fill="#0A0F25" class="text-bold fill-N1" style="text-anchor:middle;font-size:16px">fn encrypt_secret</text></g><g class="bG0uY2VkLmVk"><g class="shape" ><rect x="229.000000" y="1243.000000" width="207.000000" height="66.000000" stroke="#0D32B2" fill="#F7F8FE" class=" stroke-B1 fill-B6" style="stroke-width:2;" /></g><text x="332.500000" y="1281.500000" fill="#0A0F25" class="text-bold fill-N1" style="text-anchor:middle;font-size:16px">fn db.exists_document</text></g><g class="bG0uY2VkLmdr"><g class="shape" ><rect x="188.000000" y="1429.000000" width="289.000000" height="458.000000" stroke="#0D32B2" fill="#F7F8FE" class=" stroke-B1 fill-B6" style="stroke-width:2;" /></g><text x="332.500000" y="1418.000000" fill="#0A0F25" class="text fill-N1" style="text-anchor:middle;font-size:20px">fn key_api.generate_keys</text></g><g class="bG0uY2VkLmRl"><g class="shape" ><rect x="213.000000" y="2057.000000" width="148.000000" height="66.000000" stroke="#0D32B2" fill="#F7F8FE" class=" stroke-B1 fill-B6" style="stroke-width:2;" /></g><text x="287.000000" y="2095.500000" fill="#0A0F25" class="text-bold fill-N1" style="text-anchor:middle;font-size:16px">fn doc.encrypt</text></g><g class="bG0uY2VkLnB0"><g class="shape" ><rect x="60.000000" y="2223.000000" width="453.000000" height="66.000000" stroke="#0D32B2" fill="#F7F8FE" class=" stroke-B1 fill-B6" style="stroke-width:2;" /></g><text x="286.500000" y="2261.500000" fill="#0A0F25" class="text-bold fill-N1" style="text-anchor:middle;font-size:16px">fn db.get_document_with_previous_transaction_counter</text></g><g class="bG0uY2VkLmFk"><g class="shape" ><rect x="190.000000" y="2389.000000" width="193.000000" height="66.000000" stroke="#0D32B2" fill="#F7F8FE" class=" stroke-B1 fill-B6" style="stroke-width:2;" /></g><text x="286.500000" y="2427.500000" fill="#0A0F25" class="text-bold fill-N1" style="text-anchor:middle;font-size:16px">fn db.add_document</text></g><g class="bG0uY2VkLmdrLmdt"><g class="shape" ><rect x="232.000000" y="1459.000000" width="201.000000" height="66.000000" stroke="#0D32B2" fill="#FFFFFF" class=" stroke-B1 fill-N7" style="stroke-width:2;" /></g><text x="332.500000" y="1497.500000" fill="#0A0F25" class="text-bold fill-N1" style="text-anchor:middle;font-size:16px">fn db.get_master_key</text></g><g class="bG0uY2VkLmdrLmdkdA=="><g class="shape" ><rect x="218.000000" y="1625.000000" width="229.000000" height="66.000000" stroke="#0D32B2" fill="#FFFFFF" class=" stroke-B1 fill-N7" style="stroke-width:2;" /></g><text x="332.500000" y="1663.500000" fill="#0A0F25" class="text-bold fill-N1" style="text-anchor:middle;font-size:16px">fn db.get_document_type</text></g><g class="bG0uY2VkLmdrLmdrbQ=="><g class="shape" ><rect x="233.000000" y="1791.000000" width="199.000000" height="66.000000" stroke="#0D32B2" fill="#FFFFFF" class=" stroke-B1 fill-N7" style="stroke-width:2;" /></g><text x="332.500000" y="1829.500000" fill="#0A0F25" class="text-bold fill-N1" style="text-anchor:middle;font-size:16px">fn generate_key_map</text></g><g class="bG9nLihncCAtJmd0OyBkZSlbMF0="><marker id="mk-d2-1465926647-3488378134" markerWidth="10.000000" markerHeight="12.000000" refX="7.000000" refY="6.000000" viewBox="0.000000 0.000000 10.000000 12.000000" orient="auto" markerUnits="userSpaceOnUse"> <polygon points="0.000000,0.000000 10.000000,6.000000 0.000000,12.000000" fill="#0D32B2" class="connection fill-B1" stroke-width="2" /> </marker><path d="M 332.500000 118.000000 C 332.500000 156.000000 332.600006 176.000000 332.960003 212.000200" stroke="#0D32B2" fill="none" class="connection stroke-B1" style="stroke-width:2;" marker-end="url(#mk-d2-1465926647-3488378134)" mask="url(#d2-1465926647)" /></g><g class="bG9nLihkZSAtJmd0OyBzcClbMF0="><path d="M 359.108018 300.665021 C 395.000000 354.600006 404.250000 380.700012 404.250000 425.500000" stroke="#0D32B2" fill="none" class="connection stroke-B1" style="stroke-width:2;" marker-end="url(#mk-d2-1465926647-3488378134)" mask="url(#d2-1465926647)" /><text x="397.000000" y="365.000000" fill="#676C7E" class="text-italic fill-N2" style="text-anchor:middle;font-size:16px">No</text></g><g class="bG9nLihkZSAtJmd0OyBpYSlbMF0="><path d="M 305.891982 300.665021 C 270.000000 354.600006 260.750000 387.200012 260.750000 415.250000 C 260.750000 443.299988 269.350006 555.000000 301.141843 591.967259" stroke="#0D32B2" fill="none" class="connection stroke-B1" style="stroke-width:2;" marker-end="url(#mk-d2-1465926647-3488378134)" mask="url(#d2-1465926647)" /><text x="261.000000" y="453.000000" fill="#676C7E" class="text-italic fill-N2" style="text-anchor:middle;font-size:16px">Yes</text></g><g class="bG9nLihzcCAtJmd0OyBpYSlbMF0="><path d="M 404.250000 497.000000 C 404.250000 535.000000 395.649994 555.000000 363.858157 591.967259" stroke="#0D32B2" fill="none" class="connection stroke-B1" style="stroke-width:2;" marker-end="url(#mk-d2-1465926647-3488378134)" mask="url(#d2-1465926647)" /></g><g class="bG0uY2VkLmdrLihnbSAtJmd0OyBnZHQpWzBd"><path d="M 332.500000 1527.000000 C 332.500000 1565.000000 332.500000 1585.000000 332.500000 1621.000000" stroke="#0D32B2" fill="none" class="connection stroke-B1" style="stroke-width:2;" marker-end="url(#mk-d2-1465926647-3488378134)" mask="url(#d2-1465926647)" /></g><g class="bG0uY2VkLmdrLihnZHQgLSZndDsgZ2ttKVswXQ=="><path d="M 332.500000 1693.000000 C 332.500000 1731.000000 332.500000 1751.000000 332.500000 1787.000000" stroke="#0D32B2" fill="none" class="connection stroke-B1" style="stroke-width:2;" marker-end="url(#mk-d2-1465926647-3488378134)" mask="url(#d2-1465926647)" /></g><g class="bG0uY2VkLihlZCAtJmd0OyBnaylbMF0="><path d="M 332.500000 1311.000000 C 332.500000 1349.000000 332.500000 1366.800049 332.500000 1394.000000" stroke="#0D32B2" fill="none" class="connection stroke-B1" style="stroke-width:2;" marker-end="url(#mk-d2-1465926647-3488378134)" mask="url(#d2-1465926647)" /></g><g class="bG0uY2VkLihnayAtJmd0OyBkZSlbMF0="><path d="M 286.500000 1889.000000 C 286.500000 1943.000000 286.500000 2017.000000 286.500000 2053.000000" stroke="#0D32B2" fill="none" class="connection stroke-B1" style="stroke-width:2;" marker-end="url(#mk-d2-1465926647-3488378134)" mask="url(#d2-1465926647)" /></g><g class="bG0uY2VkLihkZSAtJmd0OyBwdClbMF0="><path d="M 286.500000 2125.000000 C 286.500000 2163.000000 286.500000 2183.000000 286.500000 2219.000000" stroke="#0D32B2" fill="none" class="connection stroke-B1" style="stroke-width:2;" marker-end="url(#mk-d2-1465926647-3488378134)" mask="url(#d2-1465926647)" /></g><g class="bG0uY2VkLihwdCAtJmd0OyBhZClbMF0="><path d="M 286.500000 2291.000000 C 286.500000 2329.000000 286.500000 2349.000000 286.500000 2385.000000" stroke="#0D32B2" fill="none" class="connection stroke-B1" style="stroke-width:2;" marker-end="url(#mk-d2-1465926647-3488378134)" mask="url(#d2-1465926647)" /></g><g class="bG0uKGRmIC0mZ3Q7IGd0KVswXQ=="><path d="M 332.500000 929.000000 C 332.500000 967.000000 332.500000 987.000000 332.500000 1023.000000" stroke="#0D32B2" fill="none" class="connection stroke-B1" style="stroke-width:2;" marker-end="url(#mk-d2-1465926647-3488378134)" mask="url(#d2-1465926647)" /></g><g class="bG0uKGd0IC0mZ3Q7IGNlZClbMF0="><path d="M 332.500000 1095.000000 C 332.500000 1133.000000 332.500000 1149.800049 332.500000 1173.000000" stroke="#0D32B2" fill="none" class="connection stroke-B1" style="stroke-width:2;" marker-end="url(#mk-d2-1465926647-3488378134)" mask="url(#d2-1465926647)" /></g><g class="bG0uKGNlZCAtJmd0OyBpdGMpWzBd"><path d="M 286.500000 2487.000000 C 286.500000 2541.000000 286.500000 2565.000000 286.500000 2601.000000" stroke="#0D32B2" fill="none" class="connection stroke-B1" style="stroke-width:2;" marker-end="url(#mk-d2-1465926647-3488378134)" mask="url(#d2-1465926647)" /></g><g class="KGxvZyAtJmd0OyBsbSlbMF0="><path d="M 332.500000 693.000000 C 332.500000 747.000000 332.500000 766.799988 332.500000 786.000000" stroke="#0D32B2" fill="none" class="connection stroke-B1" style="stroke-width:2;" marker-end="url(#mk-d2-1465926647-3488378134)" mask="url(#d2-1465926647)" /></g><g class="KGxtLmNlZC5nay5na20gLSZndDsgZ2ttKVswXQ=="><path d="M 360.018159 1858.546536 C 391.549988 1897.000000 399.750000 1917.000000 399.750000 1932.000000 C 399.750000 1947.000000 440.350006 2017.000000 598.866077 2056.043369" stroke="#0D32B2" fill="none" class="connection stroke-B1" style="stroke-width:2;" marker-end="url(#mk-d2-1465926647-3488378134)" mask="url(#d2-1465926647)" /></g><g class="Z2ttLihpayAtJmd0OyBkaylbMF0="><path d="M 723.500000 2125.000000 C 723.500000 2163.000000 723.500000 2183.000000 723.500000 2219.000000" stroke="#0D32B2" fill="none" class="connection stroke-B1" style="stroke-width:2;" marker-end="url(#mk-d2-1465926647-3488378134)" mask="url(#d2-1465926647)" /></g><g class="Z2ttLihkayAtJmd0OyByaylbMF0="><path d="M 723.500000 2291.000000 C 723.500000 2329.000000 723.500000 2349.000000 723.500000 2385.000000" stroke="#0D32B2" fill="none" class="connection stroke-B1" style="stroke-width:2;" marker-end="url(#mk-d2-1465926647-3488378134)" mask="url(#d2-1465926647)" /></g><g class="Z2ttLihyayAtJmd0OyBrZSlbMF0="><path d="M 723.500000 2457.000000 C 723.500000 2495.000000 723.500000 2565.000000 723.500000 2601.000000" stroke="#0D32B2" fill="none" class="connection stroke-B1" style="stroke-width:2;" marker-end="url(#mk-d2-1465926647-3488378134)" mask="url(#d2-1465926647)" /></g><g class="Z2ttLihrZSAtJmd0OyBlcylbMF0="><path d="M 723.500000 2673.000000 C 723.500000 2711.000000 723.500000 2781.000000 723.500000 2817.000000" stroke="#0D32B2" fill="none" class="connection stroke-B1" style="stroke-width:2;" marker-end="url(#mk-d2-1465926647-3488378134)" mask="url(#d2-1465926647)" /></g><mask id="d2-1465926647" maskUnits="userSpaceOnUse" x="-101" y="-121" width="1052" height="3139">
<rect x="-101" y="-121" width="1052" height="3139" fill="white"></rect>
<rect x="322.000000" y="-21.000000" width="66" height="36" fill="rgba(0,0,0,0.75)"></rect>
<rect x="195.500000" y="790.000000" width="182" height="36" fill="rgba(0,0,0,0.75)"></rect>
<rect x="596.000000" y="1986.000000" width="255" height="36" fill="rgba(0,0,0,0.75)"></rect>
<rect x="269.500000" y="72.500000" width="127" height="21" fill="rgba(0,0,0,0.75)"></rect>
<rect x="263.500000" y="617.500000" width="138" height="21" fill="rgba(0,0,0,0.75)"></rect>
<rect x="334.500000" y="451.500000" width="140" height="21" fill="rgba(0,0,0,0.75)"></rect>
<rect x="280.500000" y="251.500000" width="105" height="21" fill="rgba(0,0,0,0.75)"></rect>
<rect x="223.500000" y="1049.500000" width="218" height="21" fill="rgba(0,0,0,0.75)"></rect>
<rect x="238.500000" y="883.500000" width="188" height="21" fill="rgba(0,0,0,0.75)"></rect>
<rect x="84.000000" y="1177.000000" width="405" height="31" fill="rgba(0,0,0,0.75)"></rect>
<rect x="152.500000" y="2627.500000" width="268" height="21" fill="rgba(0,0,0,0.75)"></rect>
<rect x="667.500000" y="2079.500000" width="112" height="21" fill="rgba(0,0,0,0.75)"></rect>
<rect x="655.500000" y="2245.500000" width="136" height="21" fill="rgba(0,0,0,0.75)"></rect>
<rect x="672.500000" y="2411.500000" width="102" height="21" fill="rgba(0,0,0,0.75)"></rect>
<rect x="674.500000" y="2627.500000" width="99" height="21" fill="rgba(0,0,0,0.75)"></rect>
<rect x="661.500000" y="2843.500000" width="125" height="21" fill="rgba(0,0,0,0.75)"></rect>
<rect x="251.500000" y="1265.500000" width="162" height="21" fill="rgba(0,0,0,0.75)"></rect>
<rect x="226.000000" y="1398.000000" width="213" height="26" fill="rgba(0,0,0,0.75)"></rect>
<rect x="235.500000" y="2079.500000" width="103" height="21" fill="rgba(0,0,0,0.75)"></rect>
<rect x="82.500000" y="2245.500000" width="408" height="21" fill="rgba(0,0,0,0.75)"></rect>
<rect x="212.500000" y="2411.500000" width="148" height="21" fill="rgba(0,0,0,0.75)"></rect>
<rect x="254.500000" y="1481.500000" width="156" height="21" fill="rgba(0,0,0,0.75)"></rect>
<rect x="240.500000" y="1647.500000" width="184" height="21" fill="rgba(0,0,0,0.75)"></rect>
<rect x="255.500000" y="1813.500000" width="154" height="21" fill="rgba(0,0,0,0.75)"></rect>
<rect x="388.000000" y="349.000000" width="18" height="21" fill="black"></rect>
<rect x="250.000000" y="437.000000" width="22" height="21" fill="black"></rect>
</mask></svg></svg>
</pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="communication-proposal"><a class="header" href="#communication-proposal">Communication Proposal</a></h1>
<p>Für den aktuellen Betrieb des MDS würden wir auf die Clearinghouse Specification des IDS RAM 4.0 setzen.
Dabie kann das bestehende Clearinghouse angepasst und verbessert werden durch die folgenden Punkte:</p>
<p>Austausch des Trusted Connectors mittels EDC
Zusammenführung der MS zur CH-APP
Austausch des Webservers Rocket durch Axum
Wartung und Optimierungen
Stabilität durch Mutex
Update der Dependencies
Dadurch ist das Clearinghouse IDS RAM 4.0 complient und rückwärts kompatibel mit EDC MS8</p>
<h3 id="offene-entscheidungen"><a class="header" href="#offene-entscheidungen">Offene Entscheidungen:</a></h3>
<p>Blockchain
Masterkey
Future
Im DSP wird es kein Clearinghouse wie es in der IDS RAM 4.0 spezifiziert mehr geben.
Das Clearinghouse wird vom DSP ledeglich als Teilnehmer gesehen.
Dabei werden die Logs der Connectoren dezentral nur im jeweiligen Connector liegen.
Das Clearinghouse im bereich Logging könnte somit einen Vertrag mit allen Connectoren schließen um diese Logs anzufragen.</p>
<h3 id="clearinghouse-und-daps"><a class="header" href="#clearinghouse-und-daps">Clearinghouse und DAPS</a></h3>
<p>In Hinblick auf die anstehende Migration zu did:web bietet das Clearnghouse einen sinnvollen Ersatz für den DAPS.
Das Clearinghouse könnte Verifiable Credentials ausstellen, sobald die Teilnehmer den Vertrag mit diesem eingegangen sind und die Grundvorraussetzungen um am Dataspace zu partizipieren erfüllt sind. Jeder Teilnehmer darf nur mit Mitgliedern des Dataspaces interagieren, die dieses Verifiable Credential vorweisen können.
Dadurch wird sichergestellt das alle Teilnehmer am Datenraum das Clearinghouse akzeptieren.</p>
<h2 id="aktuelle-implementierung"><a class="header" href="#aktuelle-implementierung">Aktuelle Implementierung</a></h2>
<p>Der Endpunkt <code>POST /messages/log/:PID</code> wird mit einer zufällig generierten PID aufgerufen. Das hat einige Nachteile:</p>
<ul>
<li>Es wird für jede Transaktion ein neuer Prozess angelegt.</li>
<li>Transaktionen können nicht gruppiert (einem Vertrag zugeordnet) werden.</li>
<li>Transaktionen von anderen Connectoren können nicht zur gleichen Transaktion gefiltert werden.</li>
</ul>
<h2 id="optimierter-ansatz"><a class="header" href="#optimierter-ansatz">Optimierter Ansatz</a></h2>
<p>Bevor eine Transaktion stattfindet, wird ein Vertrag geschlossen. In diesem Schritt könnte der Prozess im Clearinghouse bereits angelegt werden. Hierbei ist es auch möglich, mehrere Connector IDs anzugeben, um festzulegen, wer Lese- und Schreibrechte besitzt.</p>
<ul>
<li>Die erstellte PID muss mit allen Connectoren geteilt werden.</li>
<li>Die Connectoren können auf die gleiche PID loggen, um die Transaktionen nach Verträgen zu gruppieren.</li>
<li>Der MDS kann seinen eigenen Connector als Standard festlegen, um Zugriff auf alle Transaktionen zu erhalten.</li>
</ul>
<h2 id="ablauf"><a class="header" href="#ablauf">Ablauf</a></h2>
<h3 id="createlogmessage"><a class="header" href="#createlogmessage">CreateLogMessage</a></h3>
<p><img src="./images/CreateLogMessage.png" alt="" /></p>
<h3 id="createpid"><a class="header" href="#createpid">CreatePID</a></h3>
<p><img src="./images/CreatePid.png" alt="" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ids-clearing-house"><a class="header" href="#ids-clearing-house">IDS Clearing House</a></h1>
<p>The IDS Clearing House Service is a prototype implementation of the <a href="https://github.com/International-Data-Spaces-Association/IDS-RAM_4_0/blob/main/documentation/3_Layers_of_the_Reference_Architecture_Model/3_5_System_Layer/3_5_5_Clearing_House.md">Clearing House</a> component of the <a href="https://internationaldataspaces.org/">Industrial Data Space</a>.</p>
<p>Data in the Clearing House is stored encrypted and practically immutable. There are multiple ways in which the Clearing House enforces Data Immutability:</p>
<ul>
<li>Using the <code>Logging Service</code> there is no way to update an already existing log entry in the database</li>
<li>Log entries in the database include a hash value of the previous log entry, chaining together all log entries. Any change to a previous log entry would require rehashing all following log entries.</li>
<li>The connector logging information in the Clearing House receives a signed receipt from the Clearing House that includes among other things a timestamp and the current chain hash. A single valid receipt in possession of any connector is enough to detect any change to data up to the time indicated in the receipt.</li>
</ul>
<h2 id="architecture-1"><a class="header" href="#architecture-1">Architecture</a></h2>
<p>The IDS Clearing House Service currently implements the <a href="https://github.com/International-Data-Spaces-Association/IDS-RAM_4_0/blob/main/documentation/3_Layers_of_the_Reference_Architecture_Model/3_5_System_Layer/3_5_5_Clearing_House.md"><code>Logging Service</code></a>. Other services that comprise the <a href="https://github.com/International-Data-Spaces-Association/IDS-RAM_4_0/blob/main/documentation/3_Layers_of_the_Reference_Architecture_Model/3_5_System_Layer/3_5_5_Clearing_House.md">Clearing House</a> may follow. The Clearing House Service consists of two parts:</p>
<ol>
<li><a href="clearing-house-app"><code>Clearing House App</code></a></li>
<li><a href="clearing-house-processors"><code>Clearing House Processors</code></a></li>
</ol>
<p>The <code>Clearing House App</code> is a REST API written in <a href="https://www.rust-lang.org">Rust</a> that implements the business logic of the Clearing House. The <code>Clearing House Processors</code> is a library written in Java that integrates the <code>Clearing House App</code> into the <a href="https://github.com/industrial-data-space/trusted-connector">Trusted Connector</a>. The <code>Clearing House Processors</code> provide the <code>multipart</code> and <code>idscp2</code> endpoints described in the <a href="https://github.com/International-Data-Spaces-Association/IDS-G/tree/main">IDS-G</a>. These are used by the IDS connectors to interact with the Clearing House. Both <code>Clearing House App</code> and <code>Clearing House Processors</code> are needed to provide the <code>Clearing House Service</code>.</p>
<h2 id="requirements"><a class="header" href="#requirements">Requirements</a></h2>
<ul>
<li><a href="https://www.openssl.org">OpenSSL</a></li>
<li><a href="https://www.mongodb.com">MongoDB</a></li>
<li>(<a href="https://www.docker.com">Docker</a>)</li>
<li><a href="https://github.com/industrial-data-space/trusted-connector">Trusted Connector</a></li>
</ul>
<h2 id="trusted-connector"><a class="header" href="#trusted-connector">Trusted Connector</a></h2>
<p>The Clearing House Service API requires a Trusted Connector <a href="https://github.com/industrial-data-space/trusted-connector">Trusted Connector</a> (Version 7.1.0+) for deployment. The process of setting up a Trusted Connector is described <a href="https://industrial-data-space.github.io/trusted-connector-documentation/docs/getting_started/">here</a>. Using a docker image of the Trusted Connector should be sufficient for most deployments:</p>
<p><code>docker pull fraunhoferaisec/trusted-connector-core:7.2.0</code></p>
<p>The Clearing House Processors are written in Java for use in the Camel Component of the Trusted Connector. To configure the Trusted Connector for the Clearing House Service API, it needs access to the following files inside the docker container (e.g. mounted as a volume):</p>
<ul>
<li><code>clearing-house-processors.jar</code>: The Clearing House Processors need to be placed in the <code>/root/jars</code> folder of the Trusted Connector. The jar file needs to be <a href="clearing-house-processors#building-from-source">build</a> from the Clearing House Processors using <code>gradle</code>.</li>
<li><a href="clearing-house-processors/src/routes/clearing-house-routes.xml"><code>clearing-house-routes.xml</code></a>: The camel routes required by the Clearing House need to be placed in the <code>/root/deploy</code> folder of the Trusted Connector.</li>
<li><a href="docker/application.yml"><code>application.yml</code></a>: This is a new configuration file of Trusted Connector 7.0.0+. The file version in this repository enables the use of some of the environment variables documented in the next section.</li>
</ul>
<p>Besides those files that are specific for the configuration of the Clearing House Service API, the Trusted Connector requires other files for its configuration, e.g. a truststore and a keystore with appropriate key material. Please refer to the <a href="https://industrial-data-space.github.io/trusted-connector-documentation/">Documentation</a> of the Trusted Connector for more information. Also, please check the <a href="https://github.com/industrial-data-space/trusted-connector/tree/master/examples">Examples</a> as they contain up-to-date configurations for the Trusted Connector.</p>
<h4 id="environment-variables"><a class="header" href="#environment-variables">Environment Variables</a></h4>
<p>The Clearing House Processors can override some standard configuration settings of the Trusted Connector using environment variables. If these variables are not set, the Clearing House Processors will use the standard values provided by the Trusted Connector. Some of the variables are mandatory and have to be set:</p>
<ul>
<li><code>TC_DAPS_URL</code>: The url of the DAPS used by the Clearing House. The Trusted Connector uses <code>https://daps.aisec.fraunhofer.de/v3</code> as the default DAPS url.</li>
<li><code>TC_KEYSTORE_PW</code>: The password of the key store mounted in the Trusted Connector. Defaults to <code>password</code>.</li>
<li><code>TC_TRUSTSTORE_PW</code>: The password of the trust store mounted in the Trusted Connector. Defaults to <code>password</code>.</li>
<li><code>TC_CH_ISSUER_CONNECTOR</code>(mandatory): Issuer connector needed for IDS Messages as specified by the <a href="https://github.com/International-Data-Spaces-Association/InformationModel">InfoModel</a></li>
<li><code>TC_CH_AGENT</code>(mandatory): Server agent needed for IDS Messages as specified by the <a href="https://github.com/International-Data-Spaces-Association/InformationModel">InfoModel</a></li>
<li><code>SERVICE_SHARED_SECRET</code>(mandatory): Shared secret, see Configuration section</li>
<li><code>SERVICE_ID_TC</code> (mandatory): Internal ID of the <code>Trusted Connector</code> that is used by the <code>Logging Service</code> to identify the <code>Trusted Connector</code>.</li>
<li><code>SERVICE_ID_LOG</code> (mandatory): Internal ID of the <code>Logging Service</code>.</li>
</ul>
<h4 id="example-configuration-docker-compose"><a class="header" href="#example-configuration-docker-compose">Example Configuration (docker-compose)</a></h4>
<pre><code>tc-core:
    container_name: "tc-core"
    image: fraunhoferaisec/trusted-connector-core:7.1.0
    tty: true
    stdin_open: true
    volumes:
        - /var/run/docker.sock:/var/run/docker.sock
        - ./data/trusted-connector/application.yml:/root/etc/application.yml 
        - ./data/trusted-connector/allow-all-flows.pl:/root/deploy/allow-all-flows.pl
        - ./data/trusted-connector/ch-ids.p12:/root/etc/keystore.p12
        - ./data/trusted-connector/truststore.p12:/root/etc/truststore.p12
        - ./data/trusted-connector/clearing-house-processors-0.10.0.jar:/root/jars/clearing-house-processors.jar
        - ./data/trusted-connector/routes/clearing-house-routes.xml:/root/deploy/clearing-house-routes.xml
    environment:
        TC_DAPS_URL: https://&lt;my-daps-url&gt;
        SERVICE_SHARED_SECRET: &lt;shared-secret&gt;
        SERVICE_ID_TC: &lt;trusted-connector-id&gt;
        SERVICE_ID_LOG: &lt;logging-service-ic&gt;

    ports:
        - "8443:8443"
        - "9999:9999"
        - "29292:29292"
</code></pre>
<h2 id="docker-containers"><a class="header" href="#docker-containers">Docker Containers</a></h2>
<p>The dockerfiles located <a href="docker/">here</a> can be used to create containers for the services of the <a href="clearing-house-app"><code>Clearing House App</code></a>. There are two types of dockerfiles:</p>
<ol>
<li>Simple builds (e.g. <a href="docker/keyring-api.Dockerfile">dockerfile</a>) that require you to build the Service APIs yourself using <a href="https://www.rust-lang.org">Rust</a></li>
<li>Multistage builds (e.g. <a href="docker/keyring-api-multistage.Dockerfile">dockerfile</a>) that have a stage for building the rust code</li>
</ol>
<p>To build the containers check out the repository and in the main directory execute</p>
<p><code>docker build -f docker/&lt;dockerfile&gt; . -t &lt;image-name&gt;</code></p>
<h3 id="container-dependencies"><a class="header" href="#container-dependencies">Container Dependencies</a></h3>
<p><img src="doc/images/ch_container_dependencies.png" alt="Container Dependencies" /></p>
<h3 id="configuration"><a class="header" href="#configuration">Configuration</a></h3>
<p>Please read the configuration section of the service (<a href="https://github.com/Fraunhofer-AISEC/ids-clearing-house-service/tree/architecture-revamp/clearing-house-app#logging-service"><code>Logging Service</code></a>, <a href="https://github.com/Fraunhofer-AISEC/ids-clearing-house-service/tree/architecture-revamp/clearing-house-app#document-api"><code>Document API</code></a>, <a href="https://github.com/Fraunhofer-AISEC/ids-clearing-house-service/tree/architecture-revamp/clearing-house-app#keyring-api"><code>Keyring API</code></a>) you are trying to run, before using <code>docker run</code> oder <code>docker-compose</code>. All Containers build with the provided dockerfiles require at least one volume:</p>
<ol>
<li>The configuration file <code>Rocket.toml</code> is expected at <code>/server/Rocket.toml</code></li>
</ol>
<p>Containers of the Keyring API require an additional volume:</p>
<ol start="2">
<li><code>/server/init_db</code> needs to contain the <code>default_doc_type.json</code></li>
</ol>
<p>Containers of the Logging Service require an additional volume:</p>
<ol start="3">
<li>The folder containing the signing key needs to match the path configured for the signing key in <code>Rocket.toml</code>, e.g. <code>/sever/keys</code></li>
</ol>
<h2 id="shared-secret"><a class="header" href="#shared-secret">Shared Secret</a></h2>
<p>The Clearing House services use signed JWTs with HMAC and a shared secret to ensure a minimal integrity of the requests received. The <code>Trusted Connector</code> as well as the services (<a href="https://github.com/Fraunhofer-AISEC/ids-clearing-house-service/tree/architecture-revamp/clearing-house-app#logging-service"><code>Logging Service</code></a>, <a href="https://github.com/Fraunhofer-AISEC/ids-clearing-house-service/tree/architecture-revamp/clearing-house-app#document-api"><code>Document API</code></a>, <a href="https://github.com/Fraunhofer-AISEC/ids-clearing-house-service/tree/architecture-revamp/clearing-house-app#keyring-api"><code>Keyring API</code></a>) need to have access to the shared secret.</p>
<p>For production use please consider using additional protection measures.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
